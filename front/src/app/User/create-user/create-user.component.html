<div class="min-h-screen bg-slate-900 px-4 py-8 flex items-start justify-center">
  <div
    class="max-w-4xl w-full bg-slate-950/60 rounded-2xl shadow-2xl border border-slate-800 overflow-hidden"
  >
    <!-- Header -->
    <div class="flex items-center justify-between px-6 py-4 border-b border-slate-800 bg-slate-900/80">
      <div class="flex items-center gap-3">
        <div
          class="w-9 h-9 rounded-xl bg-sky-500 flex items-center justify-center text-slate-900 font-semibold"
        >
          SS
        </div>
        <div class="text-sm">
          <p class="font-semibold text-slate-100 tracking-wide">
            {{ step === 'FORM' ? 'Nuevo empleado' : 'Confirmar correo' }}
          </p>
          <p class="text-xs text-slate-400">
            {{
              step === 'FORM'
                ? 'Registro de usuario y datos del empleado'
                : 'Verificación del correo electrónico'
            }}
          </p>
        </div>
      </div>
    </div>

    <!-- Body -->
    <div class="px-6 py-6 space-y-6">
      <!-- Mensajes -->
      <div
        *ngIf="errorMessage"
        class="rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-2 text-xs text-red-300"
      >
        {{ errorMessage }}
      </div>

      <div
        *ngIf="successMessage"
        class="rounded-lg border border-emerald-500/40 bg-emerald-500/10 px-3 py-2 text-xs text-emerald-300"
      >
        {{ successMessage }}
      </div>

      <!-- PASO 1: FORMULARIO EMPLEADO -->
      <form
        *ngIf="step === 'FORM'"
        [formGroup]="form"
        (ngSubmit)="onSubmit()"
        class="space-y-8"
      >
        <!-- DATOS DE USUARIO -->
        <section class="space-y-4" formGroupName="usuario">
          <h3 class="text-sm font-semibold text-slate-200 uppercase tracking-wide">
            Datos de usuario
          </h3>

          <div class="grid md:grid-cols-2 gap-4">
            <!-- Email -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Correo electrónico
              </label>
              <div
                class="flex items-center gap-2 rounded-xl border border-slate-700 bg-slate-900 px-3 py-2.5 focus-within:border-sky-500 focus-within:ring-1 focus-within:ring-sky-500 transition-colors"
              >
                <i class="pi pi-envelope text-slate-400 text-sm"></i>
                <input
                  type="email"
                  formControlName="email"
                  class="w-full bg-transparent border-0 outline-none text-sm text-slate-100 placeholder:text-slate-500"
                  placeholder="usuario@ejemplo.com"
                />
              </div>
              <p
                class="text-[11px] text-red-400"
                *ngIf="
                  usuarioGroup.get('email')?.invalid &&
                  (usuarioGroup.get('email')?.touched || submitted)
                "
              >
                Ingresa un correo válido.
              </p>
            </div>

            <!-- Password -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Contraseña
              </label>
              <div
                class="flex items-center gap-2 rounded-xl border border-slate-700 bg-slate-900 px-3 py-2.5 focus-within:border-sky-500 focus-within:ring-1 focus-within:ring-sky-500 transition-colors"
              >
                <i class="pi pi-lock text-slate-400 text-sm"></i>
                <input
                  type="password"
                  formControlName="password"
                  class="w-full bg-transparent border-0 outline-none text-sm text-slate-100 placeholder:text-slate-500"
                  placeholder="••••••••"
                />
              </div>
              <p
                class="text-[11px] text-red-400"
                *ngIf="
                  usuarioGroup.get('password')?.invalid &&
                  (usuarioGroup.get('password')?.touched || submitted)
                "
              >
                La contraseña es requerida (mínimo 8 caracteres).
              </p>
            </div>

            <!-- Rol -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Rol
              </label>
              <select
                formControlName="rol"
                class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
              >
                <option value="TRABAJADOR">Psicologo</option>
                <option value="ADMIN">Admin</option>
                <option value="ADMINISTRATIVO">ADMINISTRATIVO</option>
                <option value="MANTENIMIENTO">MANTENIMIENTO</option>
              </select>
            </div>

            <!-- A2F + Estado -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Opciones
              </label>
              <div class="flex flex-wrap gap-4 text-xs text-slate-300">
                <label class="inline-flex items-center gap-2">
                  <input
                    type="checkbox"
                    formControlName="a2f"
                    class="h-4 w-4 rounded border-slate-600 bg-slate-900 text-sky-500 focus:ring-sky-500"
                  />
                  <span>Activar A2F</span>
                </label>
                <label class="inline-flex items-center gap-2">
                  <input
                    type="checkbox"
                    formControlName="estado"
                    class="h-4 w-4 rounded border-slate-600 bg-slate-900 text-sky-500 focus:ring-sky-500"
                  />
                  <span>Usuario activo</span>
                </label>
              </div>
            </div>
          </div>
        </section>

        <!-- DIVISOR -->
        <div class="border-t border-slate-800"></div>

        <!-- DATOS DEL EMPLEADO -->
        <section class="space-y-4" formGroupName="empleado">
          <h3 class="text-sm font-semibold text-slate-200 uppercase tracking-wide">
            Datos del empleado
          </h3>

          <div class="grid md:grid-cols-2 gap-4">
            <!-- Nombre -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Nombre completo
              </label>
              <input
                type="text"
                formControlName="nombre"
                class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                placeholder="Nombre del empleado"
              />
              <p
                class="text-[11px] text-red-400"
                *ngIf="
                  empleadoGroup.get('nombre')?.invalid &&
                  (empleadoGroup.get('nombre')?.touched || submitted)
                "
              >
                El nombre es requerido.
              </p>
            </div>

            <!-- Fecha nacimiento -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Fecha de nacimiento
              </label>
              <input
                type="date"
                formControlName="fechaNacimiento"
                class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
              />
              <p
                class="text-[11px] text-red-400"
                *ngIf="
                  empleadoGroup.get('fechaNacimiento')?.invalid &&
                  (empleadoGroup.get('fechaNacimiento')?.touched || submitted)
                "
              >
                La fecha de nacimiento es requerida.
              </p>
            </div>

            <!-- Género -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Género
              </label>
              <div class="flex gap-4 text-xs text-slate-300">
                <label class="inline-flex items-center gap-2">
                  <input
                    type="radio"
                    [value]="true"
                    formControlName="genero"
                    class="h-4 w-4 text-sky-500 border-slate-600 bg-slate-900 focus:ring-sky-500"
                  />
                  <span>Masculino</span>
                </label>
                <label class="inline-flex items-center gap-2">
                  <input
                    type="radio"
                    [value]="false"
                    formControlName="genero"
                    class="h-4 w-4 text-sky-500 border-slate-600 bg-slate-900 focus:ring-sky-500"
                  />
                  <span>Femenino</span>
                </label>
              </div>
            </div>

            <!-- Estado civil -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Estado civil
              </label>
              <div class="flex gap-4 text-xs text-slate-300">
                <label class="inline-flex items-center gap-2">
                  <input
                    type="radio"
                    [value]="false"
                    formControlName="estadoCivil"
                    class="h-4 w-4 text-sky-500 border-slate-600 bg-slate-900 focus:ring-sky-500"
                  />
                  <span>Soltero(a)</span>
                </label>
                <label class="inline-flex items-center gap-2">
                  <input
                    type="radio"
                    [value]="true"
                    formControlName="estadoCivil"
                    class="h-4 w-4 text-sky-500 border-slate-600 bg-slate-900 focus:ring-sky-500"
                  />
                  <span>Casado(a)</span>
                </label>
              </div>
            </div>

            <!-- Teléfono -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Teléfono
              </label>
              <input
                type="text"
                formControlName="telefono"
                class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                placeholder="Número de contacto"
              />
            </div>

            <!-- Colegiado -->
            <div class="space-y-1.5">
              <label class="block text-xs font-medium text-slate-300">
                Colegiado
              </label>
              <input
                type="text"
                formControlName="colegiado"
                class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                placeholder="Número de colegiado"
              />
            </div>

            <!-- Salario -->
            <div class="space-y-1.5 md:col-span-2">
              <label class="block text-xs font-medium text-slate-300">
                Salario
              </label>
              <input
                type="number"
                formControlName="salario"
                step="0.01"
                min="0"
                class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                placeholder="Salario mensual"
              />
              <p
                class="text-[11px] text-red-400"
                *ngIf="
                  empleadoGroup.get('salario')?.invalid &&
                  (empleadoGroup.get('salario')?.touched || submitted)
                "
              >
                El salario es requerido y debe ser mayor o igual a 0.
              </p>
            </div>
          </div>
        </section>

        <!-- BOTONES -->
        <div class="pt-2 flex justify-end gap-3">
          <button
            type="button"
            class="px-4 py-2 rounded-xl border border-slate-600 text-xs font-medium text-slate-200 hover:bg-slate-800"
            (click)="form.reset({
              usuario: { rol: 'EMPLEADO', a2f: false, estado: true },
              empleado: { genero: true, estadoCivil: false, salario: 0 }
            }); submitted = false; errorMessage = null; successMessage = null;"
          >
            Limpiar
          </button>
          <button
            type="submit"
            class="px-5 py-2 rounded-xl bg-sky-500 hover:bg-sky-400 text-slate-900 text-xs font-semibold inline-flex items-center gap-2 disabled:opacity-60 disabled:cursor-not-allowed"
            [disabled]="form.invalid || loading"
          >
            <span *ngIf="!loading">Guardar empleado</span>
            <span *ngIf="loading" class="inline-flex items-center gap-2">
              <span
                class="h-4 w-4 border-2 border-slate-900 border-t-transparent rounded-full animate-spin"
              ></span>
              Guardando...
            </span>
          </button>
        </div>
      </form>

      <!-- PASO 2: CONFIRMAR CORREO -->
      <form
        *ngIf="step === 'CONFIRM'"
        [formGroup]="codigoForm"
        (ngSubmit)="onSubmitCodigo()"
        class="space-y-6"
      >
        <div class="space-y-2">
          <h3 class="text-sm font-semibold text-slate-200">
            Confirma tu correo electrónico
          </h3>
          <p class="text-xs text-slate-400">
            Hemos enviado un código de verificación
            <span *ngIf="pendingEmail" class="font-semibold text-slate-200">
              a {{ pendingEmail }}
            </span>.
            Ingrésalo a continuación para activar la cuenta.
          </p>
        </div>

        <div class="space-y-1.5">
          <label class="block text-xs font-medium text-slate-300">
            Código de verificación
          </label>
          <input
            type="text"
            formControlName="codigo"
            class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm text-slate-100 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
            placeholder="Ingresa el código recibido"
          />
          <p
            class="text-[11px] text-red-400"
            *ngIf="
              codigoForm.get('codigo')?.invalid &&
              (codigoForm.get('codigo')?.touched)
            "
          >
            El código es requerido.
          </p>
        </div>

        <div class="pt-2 flex justify-between gap-3">
          <button
            type="button"
            class="px-4 py-2 rounded-xl border border-slate-600 text-xs font-medium text-slate-200 hover:bg-slate-800"
            (click)="volverAlFormulario()"
          >
            Volver al formulario
          </button>
          <button
            type="submit"
            class="px-5 py-2 rounded-xl bg-sky-500 hover:bg-sky-400 text-slate-900 text-xs font-semibold inline-flex items-center gap-2 disabled:opacity-60 disabled:cursor-not-allowed"
            [disabled]="codigoForm.invalid || loading"
          >
            <span *ngIf="!loading">Confirmar código</span>
            <span *ngIf="loading" class="inline-flex items-center gap-2">
              <span
                class="h-4 w-4 border-2 border-slate-900 border-t-transparent rounded-full animate-spin"
              ></span>
              Verificando...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
